@if (hasAtLeastOneSupply()) {

<div class="shadow-lg rounded-lg overflow-hidden border border-gray-300 bg-white">
  <div
    class="px-8 py-6 flex items-center justify-between"
    
  >
    <div id="card-header-content">
      <h2 class="text-2xl font-medium m-0 truncate">{{ suppliesData()[0].address }}</h2>
      <p class="text-base mt-1 mb-1">
        <span class="truncate">NIS: {{ suppliesData()[0].nis }}</span>
        <span class="mr-2 ml-2">|</span>
        <span class="truncate">Alias: {{ suppliesData()[0].alias }} </span>
      </p>
      <div class="mt-2">
        @for (tag of suppliesData()[0].tags; track $index) {
        <span
          class="inline bg-gray-100 text-gray-700 pt-1 pb-1 pl-2 pr-2 mr-1 rounded-xs text-xs"
          >{{ tag.text }}</span
        >
        }
      </div>
    </div>

    <div id="selector-buttons" class="flex items-center align-center">
      <button mat-icon-button class="cursor-pointer" (click)="openSuplyMenu()">
        <!-- Would use icon from Material, but the later is a better match from Figma mock-->
        <!-- <mat-icon>settings</mat-icon> -->
        <span class="material-symbols-outlined"> settings </span>
      </button>

      @if (hasManySupplies()) {
      <button (click)="toggleAccordion()"
        class="ml-4 sm:w-10 sm:h-10 lg:w-16 lg:h-16 bg-sky-200 flex items-center justify-center rounded-full cursor-pointer">
        <mat-icon class="!text-sky-600">
          @if (isOpen) { expand_less } @else { expand_more }
        </mat-icon>
      </button>
      }
    </div>
  </div>

  @if (hasManySupplies()) {
  <div
    class="flex justify-center align-center overflow-hidden bg-blue-200 card-content"
    [class.open]="isOpen"
  >
    <!-- We use the Input Suggest for Linked supply template-->
    @if (hasSuppliesAboveThreshold()) {
    <ng-container *ngTemplateOutlet="SuppliesSearchTemplate"></ng-container>
    }
    <!-- We use the Linked supply template-->
    @else { @for (supply of secondarySupplies; track $index) {
    <ng-container
      *ngTemplateOutlet="
        SecondarySuppliesTemplate;
        context: { $implicit: supply }
      "
    ></ng-container>
    } }
  </div>
  }
</div>

} @else {
<div class="p-4 flex flex-wrap rounded-lg overflow-hidden border border-yellow-500 bg-yellow-100">
  <h2 class="basis-full text-lg font-medium mb-2">Sin suministros actualmente</h2>
  <p class="font-light text-sm">Al momento no hay suministros asociados al usuario</p>
</div>
}

<ng-template #SecondarySuppliesTemplate let-linkedsupply>
  <div class="p-4 flex-grow shadow-lg rounded-lg overflow-hidden bg-white last:ml-4">
    <p class="text-sm font-light text-gray-600">Suministro asociado</p>
    <h2 class="text-xl font-semibold m-0">{{ linkedsupply.address }}</h2>
    <p class="text-sm mt-1 mb-1">
      <span class="truncate">Localidad: {{ linkedsupply.area }}</span>
      <span class="mr-2 ml-2">|</span>
      <span class="truncate">Alias: {{ linkedsupply.alias }} </span>
    </p>
  </div>
</ng-template>

<ng-template #SuppliesSearchTemplate>
  <div class="flex flex-col align-center justify-start basis-full overflow-hidden p-6">
    <h3 class="text-lg text-[#00073E]">Encontrá más rápido</h3>
    <p class="text-sm text-[#00073E]">Hemos reemplazado las tarjetas por un buscador para facilitar la selección cuando hay más de 2 suministros.</p>

    <div class="mt-4 align-start flex-grow">
      <input
        matInput
        type="text"
        placeholder="Buscar suministros asociados"
        class="w-full px-[14px] py-2.5 text-sm placeholder-gray-400 border border-gray-600 bg-white rounded"
        [formControl]="myControl"
        [matAutocomplete]="auto"
      />
      <mat-autocomplete
        #auto="matAutocomplete"
        class="!p-0 !bg-white !rounded-lg !max-h-96"
        [displayWith]="displaySupplyAddress">

        <div class="p-4 flex basis-full sticky top-0 z-2 bg-white">
          <h3 class="text-gray-500 font-semibold">Lista de suministros asociados a tu cuenta</h3>
        </div>
        
        <div class="py-4">
          @for (option of filteredOptions | async; track option) {
            <mat-option
              class="!p-4 !px-6 border-0 cursor-pointer !hover:bg-sky-300"
              [value]="option"
              (click)="selectSupply(option)">
    
              <h3 class="font-medium truncate">{{ option.address }}</h3>
              <p class="text-sm truncate">
                NIS: {{ option.nis }} | Alias: {{ option.alias || "Sin datos" }}
              </p>
    
            </mat-option>
            }
        </div>

        <div class="p-6 flex basis-full justify-center sticky bottom-0 bg-sky-100">
          <a class="flex text-sky-500 cursor-pointer">Ver los suministros asociados <mat-icon class="ml-2">arrow_forward</mat-icon></a>
        </div>
      </mat-autocomplete>
    </div>
  </div>
  
</ng-template>
