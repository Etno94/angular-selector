@if (hasAtLeastOneSupply()) {

  <div class="shadow-lg rounded-lg overflow-hidden bg-white">
    <div
      class="p-4 flex items-center justify-between"
      (click)="toggleAccordion()"
    >
      <div id="card-header-content">
        <h2 class="text-xl font-semibold m-0">{{ suppliesData()[0].address }}</h2>
        <p class="text-sm mt-1 mb-1">
          <span class="nis">NIS: {{ suppliesData()[0].nis }}</span>
          <span class="mr-2 ml-2">|</span>
          <span class="alias">Alias: {{ suppliesData()[0].alias }} </span>
        </p>
        <div class="mt-2">
          @for (tag of suppliesData()[0].tags; track $index) {
          <span
            class="inline bg-gray-100 text-gray-700 pt-1 pb-1 pl-2 pr-2 mr-1 rounded-xs text-xs"
            >{{ tag.text }}</span
          >
          }
        </div>
      </div>
  
      <div id="selector-buttons">
        <button mat-icon-button class="" (click)="openSuplyMenu()">
          <mat-icon>settings</mat-icon>
        </button>

        @if (hasManySupplies()) {
          <button class="">
            @if (isOpen) {
            <mat-icon>expand_less</mat-icon>
            } @else {
            <mat-icon>expand_more</mat-icon>
            }
          </button>
        } 
        
      </div>
    </div>

    @if (hasManySupplies()) {
      <div class="flex overflow-hidden bg-blue-200 card-content" [class.open]="isOpen">
        <!-- We use the Input Suggest for Linked supply template-->
        @if (hasSuppliesAboveThreshold()) {
          <ng-container *ngTemplateOutlet="SuppliesSearchTemplate" ></ng-container>
        } 
        <!-- We use the Linked supply template-->
        @else {
          @for (supply of secondarySupplies; track $index) {
            <ng-container *ngTemplateOutlet="SecondarySuppliesTemplate; context: { $implicit: supply }" ></ng-container>
          }
        }
      </div>
    }
    
  </div>

} 
@else {
  <div class="shadow-lg rounded-lg overflow-hidden bg-white">
    <div class="p-4 flex items-center justify-between">
      <h2 class="text-xl font-semibold m-0">No hay suministro</h2>
    </div>
  </div>
}

<ng-template #SecondarySuppliesTemplate let-linkedsupply>
  <div class="shadow-lg rounded-lg overflow-hidden bg-white">
    <h3>Suministro</h3>
    <h2 class="text-xl font-semibold m-0">{{ linkedsupply.address }}</h2>
    <p class="text-sm mt-1 mb-1">
      <span class="nis">Localidad: {{ linkedsupply.area }}</span>
      <span class="mr-2 ml-2">|</span>
      <span class="alias">Alias: {{ linkedsupply.alias }} </span>
    </p>
  </div>
</ng-template>

<ng-template #SuppliesSearchTemplate>

  <div class="p-4">
    <input matInput 
      type="text"
      placeholder="Buscar suministro"
      class="w-full p-2 border rounded"
      [formControl]="myControl"
      [matAutocomplete]="auto"
    />
    <mat-autocomplete autoActiveFirstOption #auto="matAutocomplete" [displayWith]="displaySupplyAddress">
      @for (option of filteredOptions | async; track option) {
        <mat-option class="p-2 border-b cursor-pointer hover:bg-gray-100" 
          [value]="option" (click)="selectSupply(option)">

          <h3 class="font-semibold">{{ option.address }}</h3>
          <p class="text-sm">
            NIS: {{ option.nis }} | Alias: {{ option.alias || 'Sin datos' }}
          </p>

        </mat-option>
      }
    </mat-autocomplete>
    
    <!-- <ul class="mt-4">
      <li
        *ngFor="let supply of filteredSupplies()"
        class="p-2 border-b cursor-pointer hover:bg-gray-100"
        (click)="selectSupply(supply)"
      >
        <h3 class="font-semibold">{{ supply.address }}</h3>
        <p class="text-sm">
          NIS: {{ supply.nis }} | Alias: {{ supply.alias || 'Sin datos' }}
        </p>
      </li>
    </ul> -->
  </div>
</ng-template>